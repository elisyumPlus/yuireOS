<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Mesai Takip | yuireOS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #22232a;
      color: #e5e7eb;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      max-width: 400px;
      width: 100%;
      margin: 0 auto;
      background: #2c2d34;
      border-radius: 18px;
      box-shadow: 0 4px 28px #0006;
      padding: 32px 24px;
      text-align: center;
      position: relative;
    }
    .brand {
      font-size: 2rem;
      color: #2563eb;
      font-weight: bold;
      letter-spacing: 0.03em;
      margin-bottom: 18px;
      display: block;
    }
    label {
      color: #b3b3c2;
      font-size: 1.09rem;
      display: block;
      margin-bottom: 8px;
      text-align: left;
      margin-left: 8px;
    }
    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      background: #22232a;
      color: #fff;
      font-size: 1.06rem;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px #2563eb22;
      outline: none;
      transition: box-shadow 0.2s;
    }
    input[type="text"]:focus,
    input[type="password"]:focus {
      box-shadow: 0 0 12px #2563eb99;
    }
    .btn {
      background: #fff;
      color: #22232a;
      padding: 12px 0;
      border: none;
      border-radius: 9px;
      cursor: pointer;
      font-size: 1.06rem;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
      transition: box-shadow 0.2s, background 0.2s, color 0.2s;
      width: 100%;
      margin-bottom: 16px;
    }
    .btn:hover,
    .btn:active,
    .btn:focus {
      box-shadow: 0 0 18px 4px #fff, 0 2px 18px rgba(255, 255, 255, 0.2);
      background: #f7f7f7;
      color: #1a1a1a;
      outline: none;
    }
    .records {
      background: #232339;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0002;
      padding: 15px 8px 7px 8px;
      margin-top: 16px;
      min-height: 48px;
      text-align: left;
    }
    .record {
      font-size: 1.06rem;
      margin-bottom: 7px;
      color: #e5e7eb;
    }
    .record .time {
      color: #22c55e;
      margin-left: 7px;
    }
    .record .type {
      font-weight: 500;
      margin-left: 6px;
    }
    .record .name {
      color: #2563eb;
      font-weight: bold;
      margin-right: 7px;
    }
    .record .date {
      color: #b3b3c2;
      margin-left: 8px;
      font-size: 0.98rem;
    }
    .dashboard {
      background: #22232a;
      border-radius: 12px;
      box-shadow: 0 2px 12px #2563eb22;
      padding: 14px 12px 10px 12px;
      margin-top: 16px;
      text-align: left;
    }
    .dashboard-title {
      color: #2563eb;
      font-size: 1.13rem;
      font-weight: bold;
      margin-bottom: 9px;
    }
    .dashboard-row {
      font-size: 1.06rem;
      margin-bottom: 7px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .dashboard-name {
      font-weight: bold;
      color: #e5e7eb;
    }
    .dashboard-total {
      color: #22c55e;
      font-weight: 500;
    }
    .note {
      color: #b3b3c2;
      font-size: 0.95rem;
      margin-top: 16px;
    }
    /* Admin butonu */
    .admin-btn-fab {
      position: fixed;
      right: 30px;
      bottom: 30px;
      background: #B10024;
      color: #fff;
      border: none;
      border-radius: 14px;
      width: 130px;
      height: 54px;
      font-size: 1.13rem;
      font-weight: bold;
      box-shadow: 0 3px 18px #B1002466;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, box-shadow 0.2s;
      z-index: 100;
      outline: none;
      letter-spacing: 0.03em;
    }
    .admin-btn-fab:hover {
      background: #82001A;
      box-shadow: 0 0 18px 6px #B1002466;
    }
    /* Şifre ekranı */
    #loginContainer {
      width: 100%;
    }
    #errorMsg {
      color: #e24343;
      margin-bottom: 12px;
      font-size: 0.95rem;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <span class="brand">yuireOS</span>

    <!-- Şifre Giriş Ekranı -->
    <div id="loginContainer">
      <label for="adminPassword">Şifre:</label>
      <input type="password" id="adminPassword" placeholder="Şifreyi girin" />
      <button class="btn" id="loginBtn">Giriş Yap</button>
      <div id="errorMsg">Şifre yanlış!</div>
    </div>

    <!-- Mesai Takip Sistemi (Başlangıçta gizli) -->
    <div id="mesaiContainer" style="display:none;">
      <label for="isim">İsminiz:</label>
      <input type="text" id="isim" placeholder="Adınızı girin" />
      <div class="actions" style="display:flex; gap:12px; margin-bottom:22px;">
        <button class="btn" onclick="mesaiKaydet('giriş')" style="flex:1;">Mesai Giriş</button>
        <button class="btn" onclick="mesaiKaydet('çıkış')" style="flex:1;">Mesai Çıkış</button>
      </div>
      <div class="records" id="records"></div>
      <div class="dashboard">
        <div class="dashboard-title">Kim Ne Kadar Çalıştı?</div>
        <div id="dashboardRows"></div>
      </div>
      <div class="note">Kayıtlar cihazda saklanır, sayfa yenilense bile kalır.</div>
    </div>

  </div>

  <!-- Admin Menüsü Butonu (Başlangıçta gizli) -->
  <button class="admin-btn-fab" id="adminBtn" style="display:none;" title="Admin Menü" onclick="goAdminPage()">
    Admin Menü
  </button>

  <script>
    const ADMIN_PASSWORD = "1234"; // İstersen buraya şifreyi değiştir
    const loginContainer = document.getElementById("loginContainer");
    const mesaiContainer = document.getElementById("mesaiContainer");
    const adminBtn = document.getElementById("adminBtn");
    const errorMsg = document.getElementById("errorMsg");

    // Mesai kayıtları
    let kayitlar = [];
    if (localStorage.getItem("mesaiKayitlar")) {
      kayitlar = JSON.parse(localStorage.getItem("mesaiKayitlar"));
      kayitlar.forEach(k => {
        k.dateObj = new Date(k.dateObj);
      });
    }

    // Tarih Saat formatlama
    function pad(n) {
      return n < 10 ? "0" + n : n;
    }
    function tarihSaatObj() {
      const d = new Date();
      const tarih =
        pad(d.getDate()) + "." + pad(d.getMonth() + 1) + "." + d.getFullYear();
      const saat = pad(d.getHours()) + ":" + pad(d.getMinutes()) + ":" + pad(d.getSeconds());
      return { tarih, saat, dateObj: d };
    }

    // Mesai kaydet fonksiyonu
    function mesaiKaydet(tip) {
      const isim = document.getElementById("isim").value.trim();
      if (!isim) {
        alert("Lütfen isminizi giriniz!");
        return;
      }
      const ts = tarihSaatObj();
      kayitlar.push({
        isim,
        tip,
        time: ts.saat,
        date: ts.tarih,
        dateObj: ts.dateObj,
      });
      kayitlariKaydet();
      guncelleKayitlar();
      guncelleDashboard();
    }

    // Kayıtları localStorage'a kaydet
    function kayitlariKaydet() {
      localStorage.setItem("mesaiKayitlar", JSON.stringify(kayitlar));
    }

    // Kayıtları güncelle
    function guncelleKayitlar() {
      const recordsDiv = document.getElementById("records");
      if (kayitlar.length === 0) {
        recordsDiv.innerHTML = '<span style="color:#b3b3c2;">Henüz kayıt yok.</span>';
        return;
      }
      recordsDiv.innerHTML = kayitlar
        .map(
          (r) =>
            `<div class="record">
            <span class="name">${r.isim}</span>
            <span class="type">${r.tip === "giriş" ? "Giriş Yaptı" : "Çıkış Yaptı"}</span>
            <span class="time">${r.time}</span>
            <span class="date">${r.date}</span>
          </div>`
        )
        .join("");
    }

    // Dashboard güncelle
    function guncelleDashboard() {
      const dashboard = document.getElementById("dashboardRows");
      if (kayitlar.length === 0) {
        dashboard.innerHTML = '<span style="color:#b3b3c2;">Henüz kayıt yok.</span>';
        return;
      }

      // Her isim için giriş-çıkış saatlerini hesapla, toplam çalışma süresi hesapla (basit)
      const calismaSaatleri = {};

      // Kayıtları isimlere göre gruplandır
      const isimler = [...new Set(kayitlar.map(k => k.isim))];

      isimler.forEach(isim => {
        const kisininKayitlari = kayitlar.filter(k => k.isim === isim);

        // Saat farklarını toplamak için
        let toplamMs = 0;
        let sonGirisZamani = null;

        kisininKayitlari.forEach(kayit => {
          if (kayit.tip === "giriş") {
            sonGirisZamani = kayit.dateObj;
          } else if (kayit.tip === "çıkış" && sonGirisZamani) {
            toplamMs += (kayit.dateObj - sonGirisZamani);
            sonGirisZamani = null;
          }
        });

        const toplamSaat = (toplamMs / (1000 * 60 * 60)).toFixed(2);
        calismaSaatleri[isim] = toplamSaat;
      });

      dashboard.innerHTML = "";
      for (const [isim, saat] of Object.entries(calismaSaatleri)) {
        dashboard.innerHTML += `<div class="dashboard-row">
          <div class="dashboard-name">${isim}</div>
          <div class="dashboard-total">${saat} saat</div>
        </div>`;
      }
    }

    // Admin sayfasına git
    function goAdminPage() {
      window.location.href = "admin.html";
    }

    // Giriş yapıldı mı kontrolü (sessionStorage ile)
    function isLoggedIn() {
      return sessionStorage.getItem("loggedIn") === "true";
    }

    // Giriş yapılınca gösterimleri ayarla
    function gosterGizle() {
      if (isLoggedIn()) {
        loginContainer.style.display = "none";
        mesaiContainer.style.display = "block";
        adminBtn.style.display = "flex";
        guncelleKayitlar();
        guncelleDashboard();
      } else {
        loginContainer.style.display = "block";
        mesaiContainer.style.display = "none";
        adminBtn.style.display = "none";
      }
    }

    // Giriş butonuna basılınca kontrol
    document.getElementById("loginBtn").addEventListener("click", () => {
      const sifre = document.getElementById("adminPassword").value.trim();
      if (sifre === ADMIN_PASSWORD) {
        sessionStorage.setItem("loggedIn", "true");
        errorMsg.style.display = "none";
        gosterGizle();
      } else {
        errorMsg.style.display = "block";
      }
    });

    // Sayfa açılırken kontrol et
    window.onload = () => {
      gosterGizle();
    };
  </script>
</body>
</html>
