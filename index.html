<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>Mesai Takip</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    background: #22232a;
    color: #e5e7eb;
    font-family: 'Segoe UI', Arial, sans-serif;
    margin: 0; padding: 20px;
    min-height: 100vh;
  }
  h1 {
    color: #2563eb;
    text-align: center;
  }
  #btnDeleteToday {
    background: #e24343;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 2px 8px #e2434322;
    margin: 10px auto;
    display: block;
  }
  #btnDeleteToday:hover {
    background: #b91c1c;
  }
  /* Diğer stil ve tema aynen kalacak... */
</style>
</head>
<body>

<h1>Mesai Takip</h1>

<button id="btnDeleteToday">Bugünkü Kayıtları Sil (Şifre: nrusplus)</button>

<div id="mesaiList"></div>

<script>
  const STORAGE_USER_KEY = 'mesai_kayitlari_user'; // Kullanıcı kayıtları (indexte gösterilen)
  const STORAGE_ADMIN_KEY = 'mesai_kayitlari_admin'; // Admin kayıtları (admin paneldeki kayıtlar)

  // Mesai kayıtlarını kullanıcı tarafında sakla ve göster
  function loadUserRecords() {
    const kayitlar = JSON.parse(localStorage.getItem(STORAGE_USER_KEY)) || [];
    const container = document.getElementById('mesaiList');
    if(kayitlar.length === 0){
      container.innerHTML = '<p>Kayıt bulunamadı.</p>';
      return;
    }

    let html = '<table border="1" style="width:100%; border-collapse: collapse; color:#e5e7eb; background:#2c2d34; text-align:left;">';
    html += '<thead><tr><th>İsim</th><th>Tip</th><th>Tarih</th><th>Saat</th><th>Çalışma Süresi</th></tr></thead><tbody>';

    // Süre hesaplama için giriş-çıkış çiftlerini bulmamız lazım.
    // Basitçe aynı isim ve tarih için giriş-çıkış var mı eşleştir.
    // Önce kayıtları isim+tarih bazında grupla:
    const grup = {};

    kayitlar.forEach(k => {
      const key = k.isim + '_' + k.tarih;
      if (!grup[key]) grup[key] = { giris: null, cikis: null, saatGiris: '', saatCikis: '' };
      if (k.tip === 'giriş') {
        grup[key].giris = k;
        grup[key].saatGiris = k.saat;
      } else if (k.tip === 'çıkış') {
        grup[key].cikis = k;
        grup[key].saatCikis = k.saat;
      }
    });

    // Şimdi kayıtları listelerken süreyi hesapla:
    kayitlar.forEach(k => {
      const key = k.isim + '_' + k.tarih;
      const grupKayit = grup[key];

      // Süre hesaplama
      let sure = '';
      if(grupKayit && grupKayit.giris && grupKayit.cikis){
        // Saatleri Date objesine çevirelim
        const [gH, gM] = grupKayit.saatGiris.split(':').map(Number);
        const [cH, cM] = grupKayit.saatCikis.split(':').map(Number);
        const girisDate = new Date(0,0,0,gH,gM);
        const cikisDate = new Date(0,0,0,cH,cM);

        let diff = (cikisDate - girisDate) / 60000; // dakika cinsinden fark
        if(diff < 0) diff = 0; // negatif olmasın
        const saat = Math.floor(diff / 60);
        const dakika = diff % 60;
        sure = `${saat} saat ${dakika} dakika`;
      }

      html += `<tr>
        <td>${k.isim}</td>
        <td>${k.tip === 'giriş' ? 'Giriş' : 'Çıkış'}</td>
        <td>${k.tarih}</td>
        <td>${k.saat}</td>
        <td>${sure}</td>
      </tr>`;
    });

    html += '</tbody></table>';
    container.innerHTML = html;
  }

  // Butonla bugünün kayıtlarını silme (şifre korumalı)
  document.getElementById('btnDeleteToday').addEventListener('click', () => {
    const sifre = prompt('Şifreyi girin:');
    if (sifre !== 'nrusplus') {
      alert('Şifre yanlış!');
      return;
    }
    const bugun = new Date();
    const gun = bugun.getDate().toString().padStart(2,'0');
    const ay = (bugun.getMonth()+1).toString().padStart(2,'0');
    const yil = bugun.getFullYear();
    const bugunStr = `${gun}.${ay}.${yil}`;

    let kayitlar = JSON.parse(localStorage.getItem(STORAGE_USER_KEY)) || [];
    // Bugünün kayıtlarını filtrele (silmek için bugünün dışındakileri al)
    kayitlar = kayitlar.filter(k => k.tarih !== bugunStr);

    localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(kayitlar));
    alert('Bugünkü kayıtlar silindi.');
    loadUserRecords();
  });

  // Sayfa yüklendiğinde kullanıcı kayıtlarını göster
  window.onload = () => {
    loadUserRecords();
  };
</script>

</body>
</html>
